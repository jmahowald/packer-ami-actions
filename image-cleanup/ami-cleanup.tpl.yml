policies:
- name: del-60-automated
  mode:
    type: periodic
    schedule: rate(1 day)
    role: arn:aws:iam::{{ AWS_ACCOUNT_ID}}:role/Custodian-ami-cleanup-role
  resource: ami
  description: |
    Delete AMI that are older than {{ INPUT_DAYS  | default("60",true) }} days and 
    have not been tagged with {{ INPUT_KEY_TAG | default("promoted",true) }}
       - "tag:{{ INPUT_KEEP_TAG | default("promoted",true)}}": absent
       - type: value
         value_type: age
         key: CreationDate
         value: {{ INPUT_DAYS | default("60",true) }}
         op: greater-than
  actions:
    - type: deregister
      delete-snapshots: true
